// file: prisma/schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Users) ---
model User {
  id            String    @id @default(uuid())
  name          String?   // Display name
  username      String    @unique
  email         String?   // Optional email
  password      String
  image         String?   @db.Text // Profile image URL
  role          String    @default("USER") // USER, MODERATOR, SELLER, ADMIN
  permissions   String?   @db.Text // JSON array of permission strings
  creditBalance Decimal   @default(0.00) @db.Decimal(10, 2)
  pointBalance  Int       @default(0)  // Point balance for rare items
  totalTopup    Decimal   @default(0.00) @db.Decimal(10, 2) // ‡∏¢‡∏≠‡∏î‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏∞‡∏™‡∏° (‡πÑ‡∏°‡πà‡∏´‡∏±‡∏Å‡∏≠‡∏≠‡∏Å)
  lifetimePoints Int      @default(0)  // ‡∏û‡∏≠‡∏¢‡∏ï‡πå‡∏™‡∏∞‡∏™‡∏°‡∏ï‡∏•‡∏≠‡∏î‡∏ä‡∏µ‡∏û
  
  orders        Order[]
  topups        Topup[]
  sessions      Session[]
  apiKeys       ApiKey[]
  auditLogs     AuditLog[]
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Session (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Session Management) ---
model Session {
  id            String    @id @default(uuid())
  token         String    @unique @db.VarChar(255)
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt     DateTime
  lastActivity  DateTime  @default(now())
  userAgent     String?   @db.Text
  ipAddress     String?   @db.VarChar(45)
  
  createdAt     DateTime  @default(now())
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á API Keys (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö External Access) ---
model ApiKey {
  id            String    @id @default(uuid())
  name          String    // ‡∏ä‡∏∑‡πà‡∏≠ API Key (‡πÄ‡∏ä‡πà‡∏ô "Mobile App", "Partner Integration")
  key           String    @unique @db.VarChar(64) // Hashed API key
  keyPrefix     String    @db.VarChar(8) // First 8 chars for identification
  userId        String
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  permissions   String?   @db.Text // JSON array of allowed permissions
  expiresAt     DateTime?
  lastUsedAt    DateTime?
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  
  @@index([keyPrefix])
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Audit Log (‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç) ---
model AuditLog {
  id            String    @id @default(uuid())
  userId        String?
  user          User?     @relation(fields: [userId], references: [id], onDelete: SetNull)
  action        String    // ‡πÄ‡∏ä‡πà‡∏ô "LOGIN", "LOGOUT", "CREATE_PRODUCT", "DELETE_USER"
  resource      String?   // ‡πÄ‡∏ä‡πà‡∏ô "Product", "User", "Order"
  resourceId    String?   // ID ‡∏Ç‡∏≠‡∏á resource ‡∏ó‡∏µ‡πà‡∏ñ‡∏π‡∏Å‡∏Å‡∏£‡∏∞‡∏ó‡∏≥
  details       String?   @db.Text // JSON ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°
  ipAddress     String?   @db.VarChar(45)
  userAgent     String?   @db.Text
  status        String    @default("SUCCESS") // SUCCESS, FAILURE
  
  createdAt     DateTime  @default(now())
  
  @@index([userId])
  @@index([action])
  @@index([createdAt])
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤ (Products) ---
model Product {
  id            String    @id @default(uuid())
  name          String
  description   String?   @db.Text
  price         Decimal   @db.Decimal(10, 2)
  discountPrice Decimal?  @db.Decimal(10, 2)
  imageUrl      String?
  category      String
  currency      String    @default("THB")  // THB or POINT
  
  secretData    String    @db.Text
  isSold        Boolean   @default(false)
  isFeatured    Boolean   @default(false)
  sortOrder     Int       @default(0)
  
  orderId       String?   @unique
  order         Order?    @relation(fields: [orderId], references: [id])

  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏ã‡∏∑‡πâ‡∏≠ (Orders) ---
model Order {
  id            String    @id @default(uuid())
  userId        String
  user          User      @relation(fields: [userId], references: [id])
  product       Product?
  totalPrice    Decimal   @db.Decimal(10, 2)
  status        String    @default("COMPLETED")
  purchasedAt   DateTime  @default(now())
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ï‡∏¥‡∏°‡πÄ‡∏á‡∏¥‡∏ô (Topups / TopUpRequests) ---
model Topup {
  id              String    @id @default(uuid())
  userId          String
  user            User      @relation(fields: [userId], references: [id])
  amount          Decimal   @db.Decimal(10, 2)
  proofImage      String?   @db.Text // Base64 or URL ‡∏£‡∏π‡∏õ‡∏™‡∏•‡∏¥‡∏õ
  status          String    @default("PENDING") // PENDING, APPROVED, REJECTED
  transactionRef  String?   @unique // EasySlip transaction reference
  senderName      String?   // ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô
  senderBank      String?   // ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ú‡∏π‡πâ‡πÇ‡∏≠‡∏ô
  receiverName    String?   // ‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
  receiverBank    String?   // ‡∏ò‡∏ô‡∏≤‡∏Ñ‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö
  createdAt       DateTime  @default(now())
}

// --- ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå (Site Settings) ---
model SiteSettings {
  id              String    @id @default(uuid())
  heroTitle       String
  heroDescription String    @db.Text
  announcement    String?   @db.Text
  
  // Banner Images (External URLs)
  bannerImage1    String?   @db.Text
  bannerTitle1    String?
  bannerSubtitle1 String?
  
  bannerImage2    String?   @db.Text
  bannerTitle2    String?
  bannerSubtitle2 String?
  
  bannerImage3    String?   @db.Text
  bannerTitle3    String?
  bannerSubtitle3 String?
  
  // Logo
  logoUrl         String?   @db.Text
  
  // Background Image
  backgroundImage String?   @db.Text
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

// --- ‡∏®‡∏π‡∏ô‡∏¢‡πå‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (Help Center) ---
model HelpArticle {
  id            String    @id @default(uuid())
  question      String    @db.Text
  answer        String    @db.Text
  category      String    @default("general")
  sortOrder     Int       @default(0)
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- ‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô (News & Promotions) ---
model NewsArticle {
  id            String    @id @default(uuid())
  title         String
  description   String    @db.Text
  imageUrl      String?   @db.Text
  link          String?   // URL ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö "‡∏≠‡πà‡∏≤‡∏ô‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏°"
  sortOrder     Int       @default(0)
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- ‡πÇ‡∏Ñ‡πâ‡∏î‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (Promo Codes) ---
model PromoCode {
  id            String    @id @default(uuid())
  code          String    @unique              // ‡πÇ‡∏Ñ‡πâ‡∏î‡∏ó‡∏µ‡πà‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡πÉ‡∏ä‡πâ (e.g. "SALE50")
  discountType  String    @default("PERCENTAGE") // PERCENTAGE or FIXED
  discountValue Decimal   @db.Decimal(10, 2)   // ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î (% ‡∏´‡∏£‡∏∑‡∏≠ ‡∏ö‡∏≤‡∏ó)
  minPurchase   Decimal?  @db.Decimal(10, 2)   // ‡∏¢‡∏≠‡∏î‡∏Ç‡∏±‡πâ‡∏ô‡∏ï‡πà‡∏≥
  maxDiscount   Decimal?  @db.Decimal(10, 2)   // ‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö %)
  usageLimit    Int?                           // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ (null = ‡πÑ‡∏°‡πà‡∏à‡∏≥‡∏Å‡∏±‡∏î)
  usedCount     Int       @default(0)          // ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡πÅ‡∏•‡πâ‡∏ß
  startsAt      DateTime  @default(now())      // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏°‡∏∑‡πà‡∏≠
  expiresAt     DateTime?                      // ‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏‡πÄ‡∏°‡∏∑‡πà‡∏≠ (null = ‡πÑ‡∏°‡πà‡∏´‡∏°‡∏î‡∏≠‡∏≤‡∏¢‡∏∏)
  isActive      Boolean   @default(true)
  
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt
}

// --- ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Footer Widget ---
model FooterWidgetSettings {
  id          String    @id @default(uuid())
  isActive    Boolean   @default(true)  // ‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
  title       String    @default("‡πÄ‡∏°‡∏ô‡∏π‡∏•‡∏±‡∏î")  // ‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠ widget
  
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

// --- ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÉ‡∏ô Footer Widget ---
model FooterLink {
  id           String    @id @default(uuid())
  label        String    // ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÇ‡∏ä‡∏ß‡πå
  href         String    // ‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏õ‡∏ó‡∏µ‡πà
  openInNewTab Boolean   @default(false)  // ‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏ó‡πá‡∏ö‡πÉ‡∏´‡∏°‡πà
  sortOrder    Int       @default(0)
  isActive     Boolean   @default(true)
  
  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

// --- ‡πÅ‡∏ñ‡∏ö‡∏ô‡∏≥‡∏ó‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å (Main Navigation) ---
model NavItem {
  id        String   @id @default(uuid())
  label     String   // ‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏°‡∏ô‡∏π‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á
  href      String   // ‡πÄ‡∏™‡πâ‡∏ô‡∏ó‡∏≤‡∏á URL
  icon      String?  // ‡∏ä‡∏∑‡πà‡∏≠ icon (optional)
  sortOrder Int      @default(0)
  isActive  Boolean  @default(true)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// --- ‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏™‡∏Å‡∏∏‡∏•‡πÄ‡∏á‡∏¥‡∏ô‡∏û‡∏¥‡πÄ‡∏®‡∏© (Currency Settings) ---
model CurrencySettings {
  id          String   @id @default("default")
  name        String   @default("‡∏û‡∏≠‡∏¢‡∏ó‡πå")      // ‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á
  symbol      String   @default("üíé")         // ‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô/‡∏™‡∏±‡∏ç‡∏•‡∏±‡∏Å‡∏©‡∏ì‡πå
  code        String   @default("POINT")      // ‡∏£‡∏´‡∏±‡∏™ (‡πÑ‡∏°‡πà‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô)
  description String?  @db.Text               // ‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢
  isActive    Boolean  @default(true)
  updatedAt   DateTime @updatedAt
}